<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Our Story Mosaic</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js"></script>

  <style>
    html, body { height: 100%; margin: 0; background: #0b0b0f; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 28px 16px 16px; }
    .title { color: #e9e9ee; font-size: 28px; letter-spacing: 0.3px; font-weight: 300; text-align: center; }
    .subtitle { color: #bdbdcc; font-size: 16px; text-align: center; margin-top: 10px; }

    #viewer{
      margin: 22px auto 0;
      width: 100%;
      height: 78vh;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 30px 70px rgba(0,0,0,0.65);
      background: #0b0b0f;
    }

    /* Hotspot styling */
   .hotspot{
  width: 18px; height: 18px;
  border-radius: 999px;
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.26);
  box-shadow: 0 10px 22px rgba(0,0,0,0.45);
  cursor: pointer;
  backdrop-filter: blur(6px);
  transition: transform .18s ease, background .18s ease;
  opacity: 0;
  pointer-events: none;
  position: relative;
}
#viewer:hover .hotspot{ opacity: 1; pointer-events: auto; }

.hotspot::after{
  content:"";
  position:absolute;
  inset:-8px;
  border-radius:999px;
  border: 1px solid rgba(255,255,255,0.20);
  opacity: 0;
  transform: scale(0.92);
  transition: opacity .18s ease, transform .18s ease;
}

@keyframes softPulse {
  0%   { box-shadow: 0 0 0 0 rgba(255,255,255,0.18), 0 10px 22px rgba(0,0,0,0.45); }
  70%  { box-shadow: 0 0 0 14px rgba(255,255,255,0.00), 0 14px 30px rgba(0,0,0,0.52); }
  100% { box-shadow: 0 0 0 0 rgba(255,255,255,0.00), 0 10px 22px rgba(0,0,0,0.45); }
}
.hotspot:hover{
  transform: scale(1.14);
  background: rgba(255,255,255,0.14);
  animation: softPulse 1.6s ease-out infinite;
}
.hotspot:hover::after{ opacity: 1; transform: scale(1); }
/* Netflix-ish mini preview card */
.preview-card{
  position: absolute;
  transform: translate(-50%, -115%);
  min-width: 220px;
  max-width: 320px;
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(18,18,24,0.92);
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 24px 60px rgba(0,0,0,0.65);
  color: #f2f2f7;
  opacity: 0;
  pointer-events: none;
  transition: opacity .14s ease, transform .14s ease;
  backdrop-filter: blur(12px);
}

.preview-title{
  font-size: 13px;
  font-weight: 650;
  letter-spacing: 0.2px;
  margin-bottom: 6px;
}

.preview-meta{
  font-size: 12px;
  color: rgba(255,255,255,0.72);
  line-height: 1.35;
}

.preview-tag{
  display: inline-block;
  margin-top: 8px;
  font-size: 11px;
  padding: 4px 8px;
  border-radius: 999px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  color: rgba(255,255,255,0.86);
}

.hotspot:hover .preview-card{
  opacity: 1;
  transform: translate(-50%, -125%);
}


    /* Modal */
    .modal-backdrop{
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.62);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 2000000;
    }
    .modal{
      width: min(720px, 96vw);
      background: rgba(20,20,26,0.96);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 18px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.70);
      overflow: hidden;
    }
    .modal-header{
      padding: 18px 18px 10px;
      color: #f2f2f7;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: start;
    }
    .modal-title{ font-size: 20px; font-weight: 600; letter-spacing: 0.2px; }
    .close{
      color: #c9c9d2;
      cursor: pointer;
      font-size: 22px;
      line-height: 20px;
      padding: 6px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
    }
    .close:hover{ background: rgba(255,255,255,0.08); }
    .meta{
      padding: 0 18px 14px;
      color: #c9c9d2;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 14px;
      font-size: 14px;
    }
    .meta b{ color: #ececf4; font-weight: 600; }
    .tag{
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      color: #e6e6ee;
      font-size: 12px;
      margin-top: 6px;
    }
    .body{
      padding: 14px 18px 18px;
      color: #e6e6ee;
      font-size: 15px;
      line-height: 1.55;
      white-space: pre-wrap;
    }

    /* Fixed picker overlay */
    #pickerBar{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      z-index: 999999;
      display: flex;
      gap: 10px;
      align-items: center;
      background: rgba(15,15,20,0.82);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 999px;
      padding: 10px 12px;
      backdrop-filter: blur(10px);
    }
    #pickerBar button{
      background: rgba(255,255,255,0.08);
      color: #e9e9ee;
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 999px;
      padding: 10px 14px;
      cursor: pointer;
      font-size: 13px;
    }
    #copyBtn{ opacity: 0.6; }
    #pickStatus{ color:#b8b8c6; font-size:12px; white-space:nowrap; }

    #pickOutput{
      position: fixed;
      left: 50%;
      bottom: 72px;
      transform: translateX(-50%);
      z-index: 999999;
      width: min(980px, 94vw);
      height: 160px;
      background: rgba(12,12,16,0.92);
      color:#e9e9ee;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 12px;
      font-size: 12px;
      line-height: 1.4;
      display: none;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">Every moment we lived… still lives here.</div>
    <div class="subtitle">Hover to reveal memories. Click a circle to read the note.</div>
    <div id="viewer"></div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="backdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="mTitle">Memory</div>
          <div class="tag" id="mTag" style="display:none;"></div>
        </div>
        <div class="close" id="closeBtn">✕</div>
      </div>
      <div class="meta">
        <div><b>Date:</b> <span id="mDate">—</span></div>
        <div><b>Location:</b> <span id="mLoc">—</span></div>
        <div style="grid-column:1 / -1;"><b>Extras:</b> <span id="mExtra">—</span></div>
      </div>
      <div class="body" id="mBody"></div>
    </div>
  </div>

  <!-- Picker UI -->
  <div id="pickerBar">
    <button id="pickBtn">Hotspot Picker: OFF</button>
    <button id="copyBtn" disabled>Copy last</button>
    <span id="pickStatus">Click OFF to turn ON</span>
  </div>
  <textarea id="pickOutput" readonly></textarea>

  <script>
    const BASE = "https://fridayflash-ux.github.io/Our-Story";
    const iiifInfo = BASE + "/info.json";

    const memories = [
 {
  id: "m1770596548404",
  rect: { x: 2155, y: 756, w: 220, h: 220 },
  title: "Grace in Every Thread",
  date: "06 Feb 2026",
  location: "City, Place",
  tag: "Stillness",
  extra: "Weather • Mood • People • Anything",
 summary: `She is a fashion diva not because of what she wears,
but because of how she wears it.

Every look she creates tells a story of culture and confidence.
Beauty appears through her thoughtful choices.

Anannya does not follow fashion.
She elevates it.`
     },
    ];

    // Modal helpers
    const backdrop = document.getElementById("backdrop");
    const closeBtn = document.getElementById("closeBtn");
    function openModal(m){
      document.getElementById("mTitle").textContent = m.title || "Memory";
      document.getElementById("mDate").textContent = m.date || "—";
      document.getElementById("mLoc").textContent = m.location || "—";
      document.getElementById("mExtra").textContent = m.extra || "—";
      document.getElementById("mBody").textContent = m.summary || "";

      const tagEl = document.getElementById("mTag");
      if (m.tag){ tagEl.style.display = "inline-block"; tagEl.textContent = m.tag; }
      else { tagEl.style.display = "none"; }
      backdrop.style.display = "flex";
    }
    function closeModal(){ backdrop.style.display = "none"; }
    closeBtn.addEventListener("click", closeModal);
    backdrop.addEventListener("click", (e)=>{ if(e.target === backdrop) closeModal(); });
    document.querySelector(".modal").addEventListener("click", (e) => e.stopPropagation());
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

    // Viewer
   const viewer = OpenSeadragon({
  id: "viewer",
  prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/",
  showNavigator: true,
  navigatorPosition: "BOTTOM_RIGHT",
  showFullPageControl: true,
  showHomeControl: true,
  showZoomControl: true,
  zoomPerScroll: 1.2,
  animationTime: 0.8,
  constrainDuringPan: true,
  maxZoomPixelRatio: 2,
  gestureSettingsMouse: {
    clickToZoom: false,
    dblClickToZoom: true
  }
});


    fetch(iiifInfo)
      .then(r => {
        if (!r.ok) throw new Error("info.json not reachable: " + r.status);
        return r.json();
      })
      .then(info => {
        // patch bad @id/id if generator wrote example.com
        info["@id"] = BASE;
        info["id"] = BASE;

        viewer.open(info);

        viewer.addOnceHandler("open", () => {
          addHotspots(info);
          initPicker(info);
        });
      })
      .catch(err => {
        console.error(err);
        alert(err.message);
      });

function addHotspots(info) {

  memories.forEach(m => {

    // center of memory rect
    const cx = m.rect.x + (m.rect.w / 2);
    const cy = m.rect.y + (m.rect.h / 2);

    const vpPoint = viewer.viewport.imageToViewportCoordinates(cx, cy);

    const el = document.createElement("div");
    el.className = "hotspot";

    // ---------- Netflix Preview ----------
    const card = document.createElement("div");
    card.className = "preview-card";
    card.innerHTML = `
      <div class="preview-title">${m.title || "Memory"}</div>
      <div class="preview-meta">
        ${m.date || ""}${m.date && m.location ? " • " : ""}${m.location || ""}
      </div>
      ${m.tag ? `<div class="preview-tag">${m.tag}</div>` : ""}
    `;

    el.appendChild(card);

    // ---------- CLICK ----------
el.addEventListener("click", (e) => {
  e.preventDefault();
  e.stopPropagation();
  console.log("HOTSPOT CLICK", m.id);

  const rect = new OpenSeadragon.Rect(m.rect.x, m.rect.y, m.rect.w, m.rect.h);
  viewer.viewport.fitBounds(viewer.viewport.imageToViewportRectangle(rect), true);

  openModal(m);
});

    });

    // ⭐ THE missing piece you noticed
    viewer.addOverlay({
      element: el,
      location: vpPoint,
      placement: OpenSeadragon.Placement.CENTER,
      checkResize: false
    });

  });
}


function escapeHtml(s){
  return String(s || "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}


    function initPicker(info){
      let pickMode = false;
      let pickSize = 220;
      let lastBlock = "";

      const btn = document.getElementById("pickBtn");
      const copyBtn = document.getElementById("copyBtn");
      const status = document.getElementById("pickStatus");
      const out = document.getElementById("pickOutput");

      function setUI(){
        btn.textContent = pickMode ? "Hotspot Picker: ON" : "Hotspot Picker: OFF";
        status.textContent = pickMode ? "Picker ON ✅ Click the mosaic" : "Click OFF to turn ON";
        out.style.display = pickMode ? "none" : "none"; // hidden until first pick
      }
      setUI();

      btn.addEventListener("click", () => {
        pickMode = !pickMode;
        setUI();
      });

      copyBtn.addEventListener("click", async () => {
        if (!lastBlock) return;
        try{
          await navigator.clipboard.writeText(lastBlock);
          status.textContent = "Copied ✅ Paste into memories[]";
        }catch{
          status.textContent = "Clipboard blocked. Select text and Ctrl+C.";
          out.focus(); out.select();
        }
      });

      viewer.addHandler("canvas-click", (event) => {
        if (!pickMode) return;

        const webPoint = event.position;
        const viewportPoint = viewer.viewport.pointFromPixel(webPoint);
        const imagePoint = viewer.viewport.viewportToImageCoordinates(viewportPoint);

        const x = Math.max(0, Math.round(imagePoint.x - pickSize / 2));
        const y = Math.max(0, Math.round(imagePoint.y - pickSize / 2));
        const w = pickSize;
        const h = pickSize;

        lastBlock =
`{
  id: "m${Date.now()}",
  rect: { x: ${x}, y: ${y}, w: ${w}, h: ${h} },
  title: "Title here",
  date: "DD MMM YYYY",
  location: "City, Place",
  tag: "Stillness",
  extra: "Weather • Mood • People • Anything",
  summary: \`Line 1
Line 2
Line 3
Line 4
Line 5
Line 6
Line 7
Line 8
Line 9
Line 10\`
},`;

        out.value = lastBlock;
        out.style.display = "block";
        copyBtn.disabled = false;
        copyBtn.style.opacity = "1";
        status.textContent = `Captured ✅ x=${x}, y=${y} (${w}×${h})`;

        event.preventDefaultAction = true;
      });
    }
  </script>
</body>
</html>
